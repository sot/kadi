
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Commands and states &#8212; kadi 7.4.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/bootstrap-astropy.css" />
    <link rel="stylesheet" type="text/css" href="_static/plot_directive.css" />
    
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/sidebar.js"></script>
    <script type="text/javascript" src="_static/copybutton.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Commands archive v2 details" href="commands_v2.html" />
    <link rel="prev" title="Chandra events" href="events.html" />
    <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:200,600' rel='stylesheet' type='text/css'/>

  </head><body>
<div class="topbar">
  <a class="brand" title="Documentation Home" href="index.html"><span id="logotext1">Ska!</span><span id="logotext2">Kadi</span><span id="logotext3"></span></a>
  <ul>
    
    <li><a class="home" title="Homepage" href="https://sot.github.io/">
        <span id="logotext1">ska</span><span id="logotext2">tools</span>
    </a></li>
    <li><a title="General Index" href="genindex.html">Index</a></li>
    <li><a title="Module Index" href="py-modindex.html">Modules</a></li>
    <li>
      
      
<form action="search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
      
    </li>
  </ul>
</div>

<div class="related">
    <h3>Navigation</h3>
    <ul>
      <li class="right">
	<a href="commands_v2.html" title="Commands archive v2 details">
	  next &raquo;
	</a>
      </li>
      <li class="right">
	<a href="events.html" title="Chandra events">
	  &laquo; previous
	</a>
	 |
      </li>
      <li>
	<a href="index.html">kadi 7.4.1 documentation</a>
	 &#187;
      </li>
      
      <li>Commands and states</li> 
    </ul>
</div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="commands-and-states">
<h1>Commands and states<a class="headerlink" href="#commands-and-states" title="Permalink to this headline">¶</a></h1>
<p><strong>Commands</strong></p>
<p>The Commands archive is a table of every load command that has been run, or is currently
approved to be run, on the spacecraft since 2002.  This archive accounts for load stoppages,
replans, and certain non-load commands like ACIS CTI runs or Normal Sun Mode transitions.</p>
<p>As of this release there are two versions of the commands archive:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#commands-archive-v2">Commands archive v2</a> (flight): this provides improved timeliness during
anomalies and better team-wide communication of non-load spacecraft
commanding. This relies on the <a class="reference external" href="https://docs.google.com/spreadsheets/d/19d6XqBhWoFjC-z1lS1nM6wLE_zjr4GYB1lOvrEGCbKQ">Chandra Command Events</a> sheet and OCCweb FOT
mission planning approved load products to maintain the commands database.</p></li>
<li><p><a class="reference internal" href="#commands-archive-v1">Commands archive v1</a> (legacy): this is the legacy version and
relies on iFOT load segments and the Chandra.cmd_states timelines database to
maintain the commands database. It is currently deprecated and will be
removed in a future release.</p></li>
</ul>
<p><strong>States and continuity</strong></p>
<p>Coupled with the commands archive is functionality determine <a class="reference internal" href="#chandra-states-and-continuity">Chandra states and continuity</a>:</p>
<ul class="simple">
<li><p><strong>State</strong> values of certain parameters of interest (obsid, SIM-Z position, commanded
attitude, ACIS power configuration, etc) over an <strong>interval of time</strong> during which all
parameters have been unaffected by commanding and are unchanged.  This provides a
compact way to represent the impact of commanding on the spacecraft state over time and
is used in <a class="reference external" href="http://cxc.cfa.harvard.edu/mta/ASPECT/tool_doc/xija/">xija thermal model</a>
predictions.</p></li>
<li><p><strong>Continuity</strong> values of certain parameters of interest at a <strong>particular time</strong>.
The continuity represents the state values at a moment in time and also includes the
date of the last command which affected the state.</p></li>
</ul>
<p>The <a class="reference internal" href="#state-keys">State keys</a> section lists all state parameters which are implemented in the
installed code.  Note that a key design feature is that is it straightforward for users
to implement their own states, often with just a few lines of code.  See the <a class="reference internal" href="#user-defined-states">User-defined states</a>
section for details.</p>
<section id="commands-archive-v2">
<h2>Commands archive v2<a class="headerlink" href="#commands-archive-v2" title="Permalink to this headline">¶</a></h2>
<p>For more details of the commands v2 archive, including important information
about network access, the timeliness of commands, configuration and process
details, please see:</p>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="commands_v2.html">Commands archive v2 details</a><ul>
<li class="toctree-l2"><a class="reference internal" href="commands_v2.html#concept-overview">Concept overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="commands_v2.html#differences-from-v1">Differences from v1</a></li>
<li class="toctree-l2"><a class="reference internal" href="commands_v2.html#scenarios">Scenarios</a></li>
<li class="toctree-l2"><a class="reference internal" href="commands_v2.html#configuration-options">Configuration options</a></li>
<li class="toctree-l2"><a class="reference internal" href="commands_v2.html#environment-variables">Environment variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="commands_v2.html#data-files-and-resources">Data files and resources</a></li>
</ul>
</li>
</ul>
</div>
<section id="initial-setup">
<h3>Initial setup<a class="headerlink" href="#initial-setup" title="Permalink to this headline">¶</a></h3>
<p>In order to use commands archive v2 to always get the most up-to-date commands,
you need to set up automated access to OCCweb so the code can fetch recent
command loads. This is done by creating a file at the top level of your home
directory called <code class="docutils literal notranslate"><span class="pre">.netrc</span></code> which includes the following contents:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">machine</span>  <span class="n">occweb</span>
<span class="n">login</span>    <span class="o">&lt;</span><span class="n">OCCweb</span> <span class="n">username</span><span class="o">&gt;</span>
<span class="n">password</span> <span class="o">&lt;</span><span class="n">OCCweb</span> <span class="n">password</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>If you have other authentication entries in the same file (e.g. for <code class="docutils literal notranslate"><span class="pre">lucky</span></code>)
then there needs to be a blank line between entries.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Make sure the file is readable only by you. On linux this is done with
<code class="docutils literal notranslate"><span class="pre">chmod</span> <span class="pre">og-rwx</span> <span class="pre">~/.netrc</span></code>.</p>
</div>
</section>
<section id="getting-commands">
<h3>Getting commands<a class="headerlink" href="#getting-commands" title="Permalink to this headline">¶</a></h3>
<p>The basic way to select commands is with the <a class="reference internal" href="api.html#kadi.commands.commands.get_cmds" title="kadi.commands.commands.get_cmds"><code class="xref py py-func docutils literal notranslate"><span class="pre">get_cmds()</span></code></a> method.  For example you can find
load commands from early in 2013 with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">cmds</span> <span class="o">=</span> <span class="n">commands</span><span class="o">.</span><span class="n">get_cmds</span><span class="p">(</span><span class="s1">&#39;2013:001:00:00:00&#39;</span><span class="p">,</span> <span class="s1">&#39;2013:001:00:56:10&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">cmds</span><span class="p">)</span>
<span class="go">        date            type      tlmsid   scs step      time      source    vcdu  params</span>
<span class="go">--------------------- ---------- ---------- --- ---- ------------- -------- ------- ------</span>
<span class="go">2013:001:00:37:37.653   ORBPOINT       None   0    0 473387924.837 DEC2412B 5533112    N/A</span>
<span class="go">2013:001:00:53:07.181 COMMAND_SW   AOACRSTD 129 1524 473388854.365 DEC2412B 5584176    N/A</span>
<span class="go">2013:001:00:54:07.181 COMMAND_SW   AOFUNCDS 129 1526 473388914.365 DEC2412B 5584410    N/A</span>
<span class="go">2013:001:00:55:07.181 COMMAND_SW   AOFUNCDS 129 1528 473388974.365 DEC2412B 5584644    N/A</span>
<span class="go">2013:001:00:56:07.181 COMMAND_SW   AONMMODE 129 1530 473389034.365 DEC2412B 5584878    N/A</span>
<span class="go">2013:001:00:56:07.181    ACISPKT AA00000000 132 1620 473389034.365 DEC2412B 5584878    N/A</span>
<span class="go">2013:001:00:56:07.181   SIMTRANS       None 132 1623 473389034.365 DEC2412B 5584878    N/A</span>
<span class="go">2013:001:00:56:07.438 COMMAND_SW   AONM2NPE 129 1532 473389034.622 DEC2412B 5584879    N/A</span>
</pre></div>
</div>
<p>In the <a class="reference internal" href="api.html#kadi.commands.commands.get_cmds" title="kadi.commands.commands.get_cmds"><code class="xref py py-func docutils literal notranslate"><span class="pre">get_cmds()</span></code></a> method, commands are selected with <code class="docutils literal notranslate"><span class="pre">start</span> <span class="pre">&lt;=</span> <span class="pre">date</span> <span class="pre">&lt;</span> <span class="pre">stop</span></code>, where each
of these are evaluated as a date string with millisec precision.  In order to get commands
at exactly a certain date you need to select with the <code class="docutils literal notranslate"><span class="pre">date</span></code> argument:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">commands</span><span class="o">.</span><span class="n">get_cmds</span><span class="p">(</span><span class="n">date</span><span class="o">=</span><span class="s1">&#39;2013:001:00:56:07.181&#39;</span><span class="p">))</span>
<span class="go">        date            type      tlmsid   scs step      time      source    vcdu  params</span>
<span class="go">--------------------- ---------- ---------- --- ---- ------------- -------- ------- ------</span>
<span class="go">2013:001:00:56:07.181 COMMAND_SW   AONMMODE 129 1530 473389034.365 DEC2412B 5584878    N/A</span>
<span class="go">2013:001:00:56:07.181    ACISPKT AA00000000 132 1620 473389034.365 DEC2412B 5584878    N/A</span>
<span class="go">2013:001:00:56:07.181   SIMTRANS       None 132 1623 473389034.365 DEC2412B 5584878    N/A</span>
</pre></div>
</div>
<p>The output <code class="docutils literal notranslate"><span class="pre">cmds</span></code> is based on the astropy <a class="reference external" href="http://docs.astropy.org/en/stable/table/index.html">Table</a> object with many powerful and handy
features built in.  For instance you could sort by <code class="docutils literal notranslate"><span class="pre">type</span></code>, <code class="docutils literal notranslate"><span class="pre">tlmsid</span></code> and <code class="docutils literal notranslate"><span class="pre">date</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">cmds_type</span> <span class="o">=</span> <span class="n">cmds</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cmds_type</span><span class="o">.</span><span class="n">sort</span><span class="p">([</span><span class="s1">&#39;type&#39;</span><span class="p">,</span> <span class="s1">&#39;tlmsid&#39;</span><span class="p">,</span> <span class="s1">&#39;date&#39;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">cmds_type</span><span class="p">)</span>
<span class="go">        date            type      tlmsid   scs step      time      source    vcdu  params</span>
<span class="go">--------------------- ---------- ---------- --- ---- ------------- -------- ------- ------</span>
<span class="go">2013:001:00:56:07.181    ACISPKT AA00000000 132 1620 473389034.365 DEC2412B 5584878    N/A</span>
<span class="go">2013:001:00:53:07.181 COMMAND_SW   AOACRSTD 129 1524 473388854.365 DEC2412B 5584176    N/A</span>
<span class="go">2013:001:00:54:07.181 COMMAND_SW   AOFUNCDS 129 1526 473388914.365 DEC2412B 5584410    N/A</span>
<span class="go">2013:001:00:55:07.181 COMMAND_SW   AOFUNCDS 129 1528 473388974.365 DEC2412B 5584644    N/A</span>
<span class="go">2013:001:00:56:07.438 COMMAND_SW   AONM2NPE 129 1532 473389034.622 DEC2412B 5584879    N/A</span>
<span class="go">2013:001:00:56:07.181 COMMAND_SW   AONMMODE 129 1530 473389034.365 DEC2412B 5584878    N/A</span>
<span class="go">2013:001:00:37:37.653   ORBPOINT       None   0    0 473387924.837 DEC2412B 5533112    N/A</span>
<span class="go">2013:001:00:56:07.181   SIMTRANS       None 132 1623 473389034.365 DEC2412B 5584878    N/A</span>
</pre></div>
</div>
<p>You can print a single command and get all the information about it:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">cmds</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
<span class="go">2013:001:00:56:07.181 ACISPKT tlmsid=AA00000000 scs=132 step=1620 source=DEC2412B vcdu=5584878 cmds=3 packet(40)=D80000300030603001300 words=3</span>
</pre></div>
</div>
<p>This command has a number of attributes like <code class="docutils literal notranslate"><span class="pre">date</span></code> or <code class="docutils literal notranslate"><span class="pre">tlmsid</span></code> (shown in the original table) as well as command <em>parameters</em>: <code class="docutils literal notranslate"><span class="pre">cmds</span></code>, <code class="docutils literal notranslate"><span class="pre">packet(40)</span></code>, and <code class="docutils literal notranslate"><span class="pre">words</span></code>.  You can access any of the attributes or parameters like a dictionary:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">cmds</span><span class="p">[</span><span class="mi">5</span><span class="p">][</span><span class="s1">&#39;packet(40)&#39;</span><span class="p">])</span>
<span class="go">D80000300030603001300</span>
</pre></div>
</div>
<p>You probably noticed the first time we printed <code class="docutils literal notranslate"><span class="pre">cmds</span></code> that the command parameters
<code class="docutils literal notranslate"><span class="pre">params</span></code> were all listed as <code class="docutils literal notranslate"><span class="pre">N/A</span></code> (Not Available).  What happens if we print the
table again:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>        <span class="n">date</span>            <span class="nb">type</span>      <span class="n">tlmsid</span>   <span class="n">scs</span> <span class="n">step</span>      <span class="n">time</span>      <span class="n">source</span>    <span class="n">vcdu</span>                     <span class="n">params</span>
<span class="o">---------------------</span> <span class="o">----------</span> <span class="o">----------</span> <span class="o">---</span> <span class="o">----</span> <span class="o">-------------</span> <span class="o">--------</span> <span class="o">-------</span> <span class="o">--------------------------------------------</span>
<span class="mi">2013</span><span class="p">:</span><span class="mi">001</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">37</span><span class="p">:</span><span class="mf">37.653</span>   <span class="n">ORBPOINT</span>       <span class="kc">None</span>   <span class="mi">0</span>    <span class="mi">0</span> <span class="mf">473387924.837</span> <span class="n">DEC2412B</span> <span class="mi">5533112</span>                                          <span class="n">N</span><span class="o">/</span><span class="n">A</span>
<span class="mi">2013</span><span class="p">:</span><span class="mi">001</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">53</span><span class="p">:</span><span class="mf">07.181</span> <span class="n">COMMAND_SW</span>   <span class="n">AOACRSTD</span> <span class="mi">129</span> <span class="mi">1524</span> <span class="mf">473388854.365</span> <span class="n">DEC2412B</span> <span class="mi">5584176</span>                                          <span class="n">N</span><span class="o">/</span><span class="n">A</span>
<span class="mi">2013</span><span class="p">:</span><span class="mi">001</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">54</span><span class="p">:</span><span class="mf">07.181</span> <span class="n">COMMAND_SW</span>   <span class="n">AOFUNCDS</span> <span class="mi">129</span> <span class="mi">1526</span> <span class="mf">473388914.365</span> <span class="n">DEC2412B</span> <span class="mi">5584410</span>                                          <span class="n">N</span><span class="o">/</span><span class="n">A</span>
<span class="mi">2013</span><span class="p">:</span><span class="mi">001</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">55</span><span class="p">:</span><span class="mf">07.181</span> <span class="n">COMMAND_SW</span>   <span class="n">AOFUNCDS</span> <span class="mi">129</span> <span class="mi">1528</span> <span class="mf">473388974.365</span> <span class="n">DEC2412B</span> <span class="mi">5584644</span>                                          <span class="n">N</span><span class="o">/</span><span class="n">A</span>
<span class="mi">2013</span><span class="p">:</span><span class="mi">001</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">56</span><span class="p">:</span><span class="mf">07.181</span> <span class="n">COMMAND_SW</span>   <span class="n">AONMMODE</span> <span class="mi">129</span> <span class="mi">1530</span> <span class="mf">473389034.365</span> <span class="n">DEC2412B</span> <span class="mi">5584878</span>                                          <span class="n">N</span><span class="o">/</span><span class="n">A</span>
<span class="mi">2013</span><span class="p">:</span><span class="mi">001</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">56</span><span class="p">:</span><span class="mf">07.181</span>    <span class="n">ACISPKT</span> <span class="n">AA00000000</span> <span class="mi">132</span> <span class="mi">1620</span> <span class="mf">473389034.365</span> <span class="n">DEC2412B</span> <span class="mi">5584878</span> <span class="n">cmds</span><span class="o">=</span><span class="mi">3</span> <span class="n">packet</span><span class="p">(</span><span class="mi">40</span><span class="p">)</span><span class="o">=</span><span class="n">D80000300030603001300</span>  <span class="o">...</span>
<span class="mi">2013</span><span class="p">:</span><span class="mi">001</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">56</span><span class="p">:</span><span class="mf">07.181</span>   <span class="n">SIMTRANS</span>       <span class="kc">None</span> <span class="mi">132</span> <span class="mi">1623</span> <span class="mf">473389034.365</span> <span class="n">DEC2412B</span> <span class="mi">5584878</span>                                          <span class="n">N</span><span class="o">/</span><span class="n">A</span>
<span class="mi">2013</span><span class="p">:</span><span class="mi">001</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">56</span><span class="p">:</span><span class="mf">07.438</span> <span class="n">COMMAND_SW</span>   <span class="n">AONM2NPE</span> <span class="mi">129</span> <span class="mi">1532</span> <span class="mf">473389034.622</span> <span class="n">DEC2412B</span> <span class="mi">5584879</span>                                          <span class="n">N</span><span class="o">/</span><span class="n">A</span>
</pre></div>
</div>
<p>So what happened?  The answer is that for performance reasons the <code class="xref py py-class docutils literal notranslate"><span class="pre">CommandTable</span></code> class is
lazy about loading the command parameters, and only does so when you directly request the
parameter value (as we did with <code class="docutils literal notranslate"><span class="pre">packet(40)</span></code>).  If you want to just fetch them all
at once you can do so with the <code class="docutils literal notranslate"><span class="pre">fetch_params()</span></code> method:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">cmds</span><span class="o">.</span><span class="n">fetch_params</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">cmds</span><span class="p">)</span>
<span class="go">        date            type      tlmsid   scs step      time      source    vcdu                     params</span>
<span class="go">--------------------- ---------- ---------- --- ---- ------------- -------- ------- --------------------------------------------</span>
<span class="go">2013:001:00:37:37.653   ORBPOINT       None   0    0 473387924.837 DEC2412B 5533112                           event_type=EQF013M</span>
<span class="go">2013:001:00:53:07.181 COMMAND_SW   AOACRSTD 129 1524 473388854.365 DEC2412B 5584176                    hex=8032000 msid=AOACRSTD</span>
<span class="go">2013:001:00:54:07.181 COMMAND_SW   AOFUNCDS 129 1526 473388914.365 DEC2412B 5584410        aopcadsd=21 hex=8030215 msid=AOFUNCDS</span>
<span class="go">2013:001:00:55:07.181 COMMAND_SW   AOFUNCDS 129 1528 473388974.365 DEC2412B 5584644        aopcadsd=32 hex=8030220 msid=AOFUNCDS</span>
<span class="go">2013:001:00:56:07.181 COMMAND_SW   AONMMODE 129 1530 473389034.365 DEC2412B 5584878                    hex=8030402 msid=AONMMODE</span>
<span class="go">2013:001:00:56:07.181    ACISPKT AA00000000 132 1620 473389034.365 DEC2412B 5584878 cmds=3 packet(40)=D80000300030603001300  ...</span>
<span class="go">2013:001:00:56:07.181   SIMTRANS       None 132 1623 473389034.365 DEC2412B 5584878                                   pos=-99616</span>
<span class="go">2013:001:00:56:07.438 COMMAND_SW   AONM2NPE 129 1532 473389034.622 DEC2412B 5584879                    hex=8030601 msid=AONM2NPE</span>
</pre></div>
</div>
<p>Finally, note that you can request the value of an attribute or parameter for the entire
command table.  Note that command rows without that parameter will have a <code class="docutils literal notranslate"><span class="pre">None</span></code> object:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">cmds</span><span class="p">[</span><span class="s1">&#39;msid&#39;</span><span class="p">])</span>
<span class="go">  msid</span>
<span class="go">--------</span>
<span class="go">    None</span>
<span class="go">AOACRSTD</span>
<span class="go">AOFUNCDS</span>
<span class="go">AOFUNCDS</span>
<span class="go">AONMMODE</span>
<span class="go">    None</span>
<span class="go">    None</span>
<span class="go">AONM2NPE</span>
</pre></div>
</div>
</section>
<section id="getting-observations">
<span id="id1"></span><h3>Getting observations<a class="headerlink" href="#getting-observations" title="Permalink to this headline">¶</a></h3>
<p>The commands archive includes special <code class="docutils literal notranslate"><span class="pre">LOAD_EVENT</span></code> commands (like the RLTT) that
contain information about observations in the loads. An “observation” is defined
as a dwell in normal point mode following a maneuver and includes most OR’s and
ER’s. These are most easily accessed via the
<a class="reference internal" href="api.html#kadi.commands.observations.get_observations" title="kadi.commands.observations.get_observations"><code class="xref py py-func docutils literal notranslate"><span class="pre">get_observations()</span></code></a> function. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">kadi.commands</span> <span class="kn">import</span> <span class="n">get_observations</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">obss</span> <span class="o">=</span> <span class="n">get_observations</span><span class="p">(</span><span class="n">obsid</span><span class="o">=</span><span class="mi">26330</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">obss</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="go">{&#39;obsid&#39;: 26330,</span>
<span class="go">&#39;simpos&#39;: 73296,</span>
<span class="go">&#39;obs_stop&#39;: &#39;2022:075:19:10:35.734&#39;,</span>
<span class="go">&#39;manvr_start&#39;: &#39;2022:075:17:39:54.696&#39;,</span>
<span class="go">&#39;targ_att&#39;: (0.105773397, -0.727314387, -0.579818109, 0.351620152),</span>
<span class="go">&#39;npnt_enab&#39;: True,</span>
<span class="go">&#39;obs_start&#39;: &#39;2022:075:17:57:55.985&#39;,</span>
<span class="go">&#39;prev_att&#39;: (0.113370245, -0.848288771, -0.329080853, 0.399072852),</span>
<span class="go">&#39;starcat_idx&#39;: 211630,</span>
<span class="go">&#39;source&#39;: &#39;MAR1422A&#39;}</span>
</pre></div>
</div>
<p>Notice that the command always returns a list of observations, even for a query
asking for a specific ObsID. The reason is that cases of multiple observations
with the same ObsID are relatively common, in particular after SCS-107 stops the
observing loads this will happen. The commands archive reflects the commands
that ran on-board, and since ObsID updates are in the observing loads those
commands no longer run after SCS-107.</p>
<p>For example, ObsID 65526 was manually commanded after the HRC B-side anomaly and
persisted for 64 distinct observations in the vehicle loads:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">obss</span> <span class="o">=</span> <span class="n">get_observations</span><span class="p">(</span><span class="n">obsid</span><span class="o">=</span><span class="mi">65526</span><span class="p">)</span>  <span class="c1"># ObsID after HRC B-side anomaly</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">obss</span><span class="p">)</span>
<span class="go">64</span>
</pre></div>
</div>
<p>Getting all the observations covering years or more is reasonably fast,
typically seconds the first query and then &lt;&lt; 1 sec for subsequent queries.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="o">%</span><span class="n">time</span> <span class="n">obss</span> <span class="o">=</span> <span class="n">get_observations</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="s1">&#39;2020:001&#39;</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="s1">&#39;2022:001&#39;</span><span class="p">)</span>
<span class="go">CPU times: user 28.4 ms, sys: 952 µs, total: 29.4 ms</span>
<span class="go">Wall time: 28.7 ms</span>
</pre></div>
</div>
<p>For a large number of observations like this you may find it convenient to turn
this into an astropy <code class="docutils literal notranslate"><span class="pre">Table</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">astropy.table</span> <span class="kn">import</span> <span class="n">Table</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">obss</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span><span class="n">obss</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">obss</span>
<span class="go">&lt;Table length=4018&gt;</span>
<span class="go">obsid simpos        obs_stop            manvr_start      ...       obs_start               prev_att [4]         starcat_idx  source</span>
<span class="go">int64 int64          str21                 str21         ...         str21                   float64               int64      str8</span>
<span class="go">----- ------ --------------------- --------------------- ... --------------------- ---------------------------- ----------- --------</span>
<span class="go">47575  75624 2020:001:06:51:13.985 2020:001:06:15:56.053 ... 2020:001:06:46:33.236   -0.51363412 .. 0.832139148      166529 DEC2319A</span>
<span class="go">23000  75624 2020:001:19:18:15.914 2020:001:06:51:24.236 ... 2020:001:07:17:16.164  -0.475120775 .. 0.693367999      166530 DEC2319A</span>
<span class="go">47574  75624 2020:001:19:48:58.024 2020:001:19:18:26.165 ... 2020:001:19:44:17.276  -0.221358674 .. 0.710485779      166531 DEC2319A</span>
<span class="gp">... </span>   <span class="o">...</span>                   <span class="o">...</span>                   <span class="o">...</span> <span class="o">...</span>                   <span class="o">...</span>                          <span class="o">...</span>         <span class="o">...</span>      <span class="o">...</span>
<span class="go">25803  75624 2021:365:13:38:31.497 2021:365:05:20:58.062 ... 2021:365:05:47:31.748 -0.488490169 .. 0.0261316575      170515 DEC3021A</span>
<span class="go">26264  75624 2021:365:18:39:19.983 2021:365:13:38:41.748 ... 2021:365:14:08:20.234 -0.0658948803 .. 0.350032226      170516 DEC3021A</span>
<span class="go">26247  75624 2022:001:05:21:28.604 2021:365:18:39:30.234 ... 2021:365:19:06:05.650  0.553670113 .. 0.0635036584      170517 DEC3021A</span>
</pre></div>
</div>
<section id="under-the-hood">
<h4>Under the hood<a class="headerlink" href="#under-the-hood" title="Permalink to this headline">¶</a></h4>
<p>The observation information is stored as <code class="docutils literal notranslate"><span class="pre">LOAD_EVENT</span></code> commands that can be viewed
directly:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">kadi.commands</span> <span class="kn">import</span> <span class="n">get_cmds</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cmds</span> <span class="o">=</span> <span class="n">get_cmds</span><span class="p">(</span><span class="s1">&#39;2022:001&#39;</span><span class="p">,</span> <span class="s1">&#39;2022:002&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;LOAD_EVENT&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">cmds</span><span class="p">)</span>
<span class="go">        date            type    tlmsid scs step      time      source  vcdu params</span>
<span class="go">--------------------- ---------- ------ --- ---- ------------- -------- ---- ------</span>
<span class="go">2022:001:05:48:44.808 LOAD_EVENT    OBS   0    0 757403393.992 DEC3021A   -1    N/A</span>
<span class="go">2022:001:09:42:05.439 LOAD_EVENT    OBS   0    0 757417394.623 DEC3021A   -1    N/A</span>
<span class="go">2022:001:11:37:20.405 LOAD_EVENT    OBS   0    0 757424309.589 DEC3021A   -1    N/A</span>
<span class="go">2022:001:15:03:39.654 LOAD_EVENT    OBS   0    0 757436688.838 DEC3021A   -1    N/A</span>
<span class="go">2022:001:15:29:26.255 LOAD_EVENT    OBS   0    0 757438235.439 DEC3021A   -1    N/A</span>
<span class="go">2022:001:17:33:53.255 LOAD_EVENT    OBS   0    0 757445702.439 DEC3021A   -1    N/A</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cmds</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;params&#39;</span><span class="p">]</span>
<span class="go">{&#39;obsid&#39;: 45814,</span>
<span class="go">&#39;simpos&#39;: -99616,</span>
<span class="go">&#39;obs_stop&#39;: &#39;2022:001:09:13:04.557&#39;,</span>
<span class="go">&#39;manvr_start&#39;: &#39;2022:001:05:21:38.855&#39;,</span>
<span class="go">&#39;targ_att&#39;: (0.530730117, 0.556620885, 0.610704042, 0.188518716),</span>
<span class="go">&#39;npnt_enab&#39;: True,</span>
<span class="go">&#39;obs_start&#39;: &#39;2022:001:05:48:44.808&#39;,</span>
<span class="go">&#39;prev_att&#39;: (-0.0743435142, -0.559183412, -0.804323901, 0.186681591),</span>
<span class="go">&#39;starcat_idx&#39;: 170518}</span>
</pre></div>
</div>
<p>As with <a class="reference internal" href="api.html#kadi.commands.commands.get_cmds" title="kadi.commands.commands.get_cmds"><code class="xref py py-func docutils literal notranslate"><span class="pre">get_cmds()</span></code></a> in the v2 archive, you can provide a
<code class="docutils literal notranslate"><span class="pre">scenario</span></code> keyword to <a class="reference internal" href="api.html#kadi.commands.observations.get_observations" title="kadi.commands.observations.get_observations"><code class="xref py py-func docutils literal notranslate"><span class="pre">get_observations()</span></code></a> to
select a custom or <code class="docutils literal notranslate"><span class="pre">'flight'</span></code> scenario.</p>
</section>
</section>
<section id="getting-star-catalogs">
<span id="id2"></span><h3>Getting star catalogs<a class="headerlink" href="#getting-star-catalogs" title="Permalink to this headline">¶</a></h3>
<p>The ACA star catalogs associated with observations can be retrieved using the
<a class="reference internal" href="api.html#kadi.commands.observations.get_starcats" title="kadi.commands.observations.get_starcats"><code class="xref py py-func docutils literal notranslate"><span class="pre">get_starcats()</span></code></a> function. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">kadi.commands</span> <span class="kn">import</span> <span class="n">get_starcats</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">acas</span> <span class="o">=</span> <span class="n">get_starcats</span><span class="p">(</span><span class="n">obsid</span><span class="o">=</span><span class="mi">26330</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">acas</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="go">&lt;ACATable length=11&gt;</span>
<span class="go">slot  idx      id    type  sz    mag    maxmag   yang     zang    dim   res  halfw</span>
<span class="go">int64 int64   int64   str3 str3 float64 float64 float64  float64  int64 int64 int64</span>
<span class="go">----- ----- --------- ---- ---- ------- ------- -------- -------- ----- ----- -----</span>
<span class="go">    0     1         2  FID  8x8    7.00    8.00  -773.14 -1862.22     1     1    25</span>
<span class="go">    1     2         4  FID  8x8    7.00    8.00  2140.38    46.50     1     1    25</span>
<span class="go">    2     3         5  FID  8x8    7.00    8.00 -1826.24    40.03     1     1    25</span>
<span class="go">    3     4 194257752  BOT  6x6    6.09    7.59 -2389.55 -1716.62    28     1   160</span>
<span class="go">    4     5 264114816  BOT  6x6    8.64   10.19    -2.30 -2430.32    28     1   160</span>
<span class="go">    5     6 194249696  BOT  6x6    8.76   10.27 -2129.92 -2447.14    28     1   160</span>
<span class="go">    6     7 263198168  BOT  6x6    8.81   10.33  -375.16  2416.16    28     1   160</span>
<span class="go">    0     8 263199776  ACQ  6x6   10.13   11.20  1385.78  1949.73     8     1    60</span>
<span class="go">    1     9 264113448  ACQ  6x6   10.27   11.20  -187.29 -1336.05     8     1    60</span>
<span class="go">    2    10 263201064  ACQ  6x6   10.44   11.20   529.26   324.30     8     1    60</span>
<span class="go">    7    11 263196576  ACQ  6x6   10.56   11.20 -1046.29   258.97    16     1   100</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code class="docutils literal notranslate"><span class="pre">ACATable</span></code> objects that are returned can be plotted but they
are not fully equivalent to the catalogs that <code class="docutils literal notranslate"><span class="pre">proseco</span></code> would return. The
CCD temperatures are set to -20 C and the <code class="docutils literal notranslate"><span class="pre">.acqs</span></code> and <code class="docutils literal notranslate"><span class="pre">.guides</span></code> attributes
are stubbed with empty tables.</p>
</div>
<section id="getting-dicts-instead-of-aca-tables">
<h4>Getting dicts instead of ACA tables<a class="headerlink" href="#getting-dicts-instead-of-aca-tables" title="Permalink to this headline">¶</a></h4>
<p>Another performance option which can be useful in some cases is to set the
<code class="docutils literal notranslate"><span class="pre">as_dict</span></code> keyword to <code class="docutils literal notranslate"><span class="pre">True</span></code>. This will return a list of dictionaries instead
of converting each catalog into an <code class="docutils literal notranslate"><span class="pre">ACATable</span></code> object.</p>
</section>
<section id="getting-a-table-of-catalog-entries">
<h4>Getting a Table of catalog entries<a class="headerlink" href="#getting-a-table-of-catalog-entries" title="Permalink to this headline">¶</a></h4>
<p>For some use cases you want a single table of all star catalog entries matching
the specified criteria. This can be done with the
<a class="reference internal" href="api.html#kadi.commands.observations.get_starcats_as_table" title="kadi.commands.observations.get_starcats_as_table"><code class="xref py py-func docutils literal notranslate"><span class="pre">get_starcats_as_table()</span></code></a> function. This is
roughly the equivalent of doing a Table <code class="docutils literal notranslate"><span class="pre">vstack</span></code> of the individual
<code class="docutils literal notranslate"><span class="pre">ACATable</span></code> catalogs but is much faster. In addition two columns <code class="docutils literal notranslate"><span class="pre">obsid</span></code> and
<code class="docutils literal notranslate"><span class="pre">starcat_date</span></code> are added to provide this information for each entry.</p>
</section>
<section id="caching">
<h4>Caching<a class="headerlink" href="#caching" title="Permalink to this headline">¶</a></h4>
<p>In order to significantly speed up the retrieval of historical star catalogs for
typical ACA operations analysis, the results of each call to <code class="docutils literal notranslate"><span class="pre">get_starcats()</span></code>
are (by default) cached in a file <code class="docutils literal notranslate"><span class="pre">~/.kadi/starcats.db</span></code>.</p>
<p>This caching is controlled by a configuration parameter <code class="docutils literal notranslate"><span class="pre">cache_starcats</span></code>. To
permanently disable caching you can edit your configuration file (see
<a class="reference internal" href="commands_v2.html#configuration-options"><span class="std std-ref">Configuration options</span></a>). To disable caching for a single call to
<code class="docutils literal notranslate"><span class="pre">get_starcats()</span></code>, you can do something like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">kadi.commands</span> <span class="kn">import</span> <span class="n">get_starcats</span><span class="p">,</span> <span class="n">conf</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="n">conf</span><span class="o">.</span><span class="n">set_temp</span><span class="p">(</span><span class="s1">&#39;cache_starcats&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
<span class="gp">... </span>   <span class="n">starcats</span> <span class="o">=</span> <span class="n">get_starcats</span><span class="p">(</span><span class="s1">&#39;2022:001&#39;</span><span class="p">,</span> <span class="s1">&#39;2022:002&#39;</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
</section>
<section id="commands-archive-v1">
<h2>Commands archive v1<a class="headerlink" href="#commands-archive-v1" title="Permalink to this headline">¶</a></h2>
<p>Version 1 of the commands archive is provided for legacy support but it will be
removed in a future release.</p>
<p>For details of the commands v1 archive please see:
please see:</p>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="commands_v1.html">Commands archive v1</a><ul>
<li class="toctree-l2"><a class="reference internal" href="commands_v1.html#notes-and-caveats">Notes and caveats</a></li>
</ul>
</li>
</ul>
</div>
</section>
<section id="chandra-states-and-continuity">
<h2>Chandra states and continuity<a class="headerlink" href="#chandra-states-and-continuity" title="Permalink to this headline">¶</a></h2>
<p>To get started, import the <code class="docutils literal notranslate"><span class="pre">kadi.commands.states</span></code> module:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">kadi.commands</span> <span class="kn">import</span> <span class="n">states</span>
</pre></div>
</div>
<p>The fundamental idea of the <code class="docutils literal notranslate"><span class="pre">states</span></code> module is that one has a state quantity
such as <code class="docutils literal notranslate"><span class="pre">obsid</span></code> or <code class="docutils literal notranslate"><span class="pre">si_mode</span></code> which is impacted by commands that Chandra
runs.  By stepping through all commands and maintaining a state vector during
that process, one assembles the state history relevant to those commands.
The identifer for each of these quantities is referred to as a <code class="docutils literal notranslate"><span class="pre">state_key</span></code></p>
<section id="states">
<h3>States<a class="headerlink" href="#states" title="Permalink to this headline">¶</a></h3>
<p>A commanded state is an interval of time over which certain parameters of interest (obsid,
SIM-Z position, commanded attitude, ACIS power configuration, etc) are unchanged.</p>
<p>The <a class="reference internal" href="api.html#kadi.commands.states.get_states" title="kadi.commands.states.get_states"><code class="xref py py-func docutils literal notranslate"><span class="pre">get_states()</span></code></a> function is the workhorse for dynamic commanded states.  This
function is fairly flexible and is roughly equivalent to the combination of the legacy
<code class="docutils literal notranslate"><span class="pre">Chandra.cmd_states</span></code> functions <code class="xref py py-func docutils literal notranslate"><span class="pre">get_states()</span></code>
and  <code class="xref py py-func docutils literal notranslate"><span class="pre">fetch_states()</span></code>.</p>
<section id="states-over-date-range">
<h4>States over date range<a class="headerlink" href="#states-over-date-range" title="Permalink to this headline">¶</a></h4>
<p>To get the commanded states over a date range you can do the following, which internally
does a call to <a class="reference internal" href="api.html#kadi.commands.commands.get_cmds" title="kadi.commands.commands.get_cmds"><code class="xref py py-func docutils literal notranslate"><span class="pre">get_cmds()</span></code></a> in order to get commands over the <code class="docutils literal notranslate"><span class="pre">start</span></code> / <code class="docutils literal notranslate"><span class="pre">stop</span></code> date
range:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">states</span><span class="o">.</span><span class="n">get_states</span><span class="p">(</span><span class="s1">&#39;2017:001:21:00:00&#39;</span><span class="p">,</span> <span class="s1">&#39;2017:002:11:29:00&#39;</span><span class="p">,</span>
<span class="gp">... </span>                  <span class="n">state_keys</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;obsid&#39;</span><span class="p">,</span> <span class="s1">&#39;simpos&#39;</span><span class="p">,</span> <span class="s1">&#39;clocking&#39;</span><span class="p">])</span>
<span class="go">&lt;Table length=9&gt;</span>
<span class="go">      datestart              datestop       obsid simpos clocking    trans_keys</span>
<span class="go">        str21                 str21         int64 int64   int64        object</span>
<span class="go">--------------------- --------------------- ----- ------ -------- ---------------</span>
<span class="go">2017:001:21:00:00.000 2017:001:21:02:06.467 18140  75624        1</span>
<span class="go">2017:001:21:02:06.467 2017:001:21:05:06.467 18140  75624        0        clocking</span>
<span class="go">2017:001:21:05:06.467 2017:001:21:05:10.467 19973  75624        0  clocking,obsid</span>
<span class="go">2017:001:21:05:10.467 2017:001:21:05:14.467 19973  75624        0        clocking</span>
<span class="go">2017:001:21:05:14.467 2017:001:21:05:38.467 19973  75624        0        clocking</span>
<span class="go">2017:001:21:05:38.467 2017:001:21:06:45.467 19973  75624        0        clocking</span>
<span class="go">2017:001:21:06:45.467 2017:002:11:23:43.185 19973  75624        1        clocking</span>
<span class="go">2017:002:11:23:43.185 2017:002:11:26:43.185 19973 -99616        0 clocking,simpos</span>
<span class="go">2017:002:11:26:43.185 2017:002:11:29:00.000 50432 -99616        0           obsid</span>
</pre></div>
</div>
<p>Each state has a start and a stop date, the values for the requested state keys, and a
column called <code class="docutils literal notranslate"><span class="pre">trans_keys</span></code> that specifies which keys had their values updated to <em>start</em>
this state.</p>
<p>The first thing to note is that <code class="docutils literal notranslate"><span class="pre">datestop</span></code> for a state is always the same as the
<code class="docutils literal notranslate"><span class="pre">datestart</span></code> for the following state.  There is no gap, and strictly speaking the state
values apply for the date range <code class="docutils literal notranslate"><span class="pre">datestart</span> <span class="pre">&lt;=</span> <span class="pre">date</span> <span class="pre">&lt;</span> <span class="pre">datestop</span></code>.  This is the same as for
getting commands.  Next note that the first <code class="docutils literal notranslate"><span class="pre">datestart</span></code> and final <code class="docutils literal notranslate"><span class="pre">datestop</span></code> match
exactly the input <code class="docutils literal notranslate"><span class="pre">start</span></code> and <code class="docutils literal notranslate"><span class="pre">stop</span></code> for the function call.  This reflects that we
only “know” the states over the time range for which commands were requested.</p>
<p>The astute reader will notice that the 3rd through 6th row says <code class="docutils literal notranslate"><span class="pre">clocking</span></code> was
updated, but looking at values they are all <code class="docutils literal notranslate"><span class="pre">0</span></code>.  What’s going on?  The answer is that,
by default, <a class="reference internal" href="api.html#kadi.commands.states.get_states" title="kadi.commands.states.get_states"><code class="xref py py-func docutils literal notranslate"><span class="pre">get_states()</span></code></a> breaks the state if the value was <em>commanded</em>, regardless of
whether the value actually changed.  So let’s dig in to the commands at exactly the state
transition time of the 3rd row:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">commands</span><span class="o">.</span><span class="n">get_cmds</span><span class="p">(</span><span class="n">date</span><span class="o">=</span><span class="s1">&#39;2017:001:21:05:06.467&#39;</span><span class="p">))</span>
<span class="go">         date           type     tlmsid   scs step timeline_id params</span>
<span class="go">--------------------- -------- ---------- --- ---- ----------- ------</span>
<span class="go">2017:001:21:05:06.467 MP_OBSID   COAOSQID 131  400   426102266    N/A</span>
<span class="go">2017:001:21:05:06.467  ACISPKT AA00000000 131  403   426102266    N/A</span>
</pre></div>
</div>
<p>So there was an ACIS stop science, which sets clocking to <code class="docutils literal notranslate"><span class="pre">0</span></code> even though it
was already <code class="docutils literal notranslate"><span class="pre">0</span></code> (from the previous stop science 3 minutes earlier).  If you are
getting states for thermal model computation then you don’t care about these identical
states.  In this case specify <code class="docutils literal notranslate"><span class="pre">merge_identical=True</span></code> in the function call:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">sts</span> <span class="o">=</span> <span class="n">states</span><span class="o">.</span><span class="n">get_states</span><span class="p">(</span><span class="s1">&#39;2017:001:21:00:00&#39;</span><span class="p">,</span> <span class="s1">&#39;2017:002:11:29:00&#39;</span><span class="p">,</span>
<span class="gp">... </span>                        <span class="n">state_keys</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;obsid&#39;</span><span class="p">,</span> <span class="s1">&#39;simpos&#39;</span><span class="p">,</span> <span class="s1">&#39;clocking&#39;</span><span class="p">],</span>
<span class="gp">... </span>                        <span class="n">merge_identical</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sts</span>
<span class="go">&lt;Table length=6&gt;</span>
<span class="go">      datestart              datestop       obsid simpos clocking    trans_keys</span>
<span class="go">        str21                 str21         int64 int64   int64        object</span>
<span class="go">--------------------- --------------------- ----- ------ -------- ---------------</span>
<span class="go">2017:001:21:00:00.000 2017:001:21:02:06.467 18140  75624        1</span>
<span class="go">2017:001:21:02:06.467 2017:001:21:05:06.467 18140  75624        0        clocking</span>
<span class="go">2017:001:21:05:06.467 2017:001:21:06:45.467 19973  75624        0           obsid</span>
<span class="go">2017:001:21:06:45.467 2017:002:11:23:43.185 19973  75624        1        clocking</span>
<span class="go">2017:002:11:23:43.185 2017:002:11:26:43.185 19973 -99616        0 clocking,simpos</span>
<span class="go">2017:002:11:26:43.185 2017:002:11:29:00.000 50432 -99616        0           obsid</span>
</pre></div>
</div>
<p>As a side note, although the <code class="docutils literal notranslate"><span class="pre">trans_keys</span></code> column looks like a string, that is
a bit of trickery that happens when you print the states table.  In fact each row
entry is a Python <code class="docutils literal notranslate"><span class="pre">set()</span></code> object.  In order to see when <code class="docutils literal notranslate"><span class="pre">obsid</span></code> changed in the
above query you could do:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="p">[</span><span class="s1">&#39;obsid&#39;</span> <span class="ow">in</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;trans_keys&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">sts</span><span class="p">]</span>
<span class="go">[False, False, True, False, False, True]</span>
</pre></div>
</div>
</section>
<section id="command-line-interface">
<h4>Command line interface<a class="headerlink" href="#command-line-interface" title="Permalink to this headline">¶</a></h4>
<p>One can do the same thing as above from the command-line using the <code class="docutils literal notranslate"><span class="pre">get_chandra_states</span></code>
command.  This outputs the table (sans trans_keys) in a space-delimited format
to the console or a specified file.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ get_chandra_states --start 2017:001:21:00:00 --stop 2017:002:11:29:00 \
                     --state-keys=obsid,simpos,clocking \
                     --merge-identical

             datestart               datestop  obsid  simpos  clocking
 2017:001:21:00:00.000  2017:001:21:02:06.467  18140   75624         1
 2017:001:21:02:06.467  2017:001:21:05:06.467  18140   75624         0
 2017:001:21:05:06.467  2017:001:21:06:45.467  19973   75624         0
 2017:001:21:06:45.467  2017:002:11:23:43.185  19973   75624         1
 2017:002:11:23:43.185  2017:002:11:26:43.185  19973  -99616         0
 2017:002:11:26:43.185  2017:002:11:29:00.000  50432  -99616         0
</pre></div>
</div>
<p>The available options are:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ get_chandra_states --help

usage: get_chandra_states [-h] [--start START] [--stop STOP]
                          [--state-keys STATE_KEYS] [--merge-identical]
                          [--outfile OUTFILE]

Ouput the Chandra commanded states over a date range as a space-delimited
ASCII table.

optional arguments:
  -h, --help            show this help message and exit
  --start START         Start date (default=Now-10 days)
  --stop STOP           Stop date (default=None)
  --state-keys STATE_KEYS
                        Comma-separated list of state keys
  --merge-identical     Merge adjacent states that have identical values
                        (default=False)
  --outfile OUTFILE     Output file (default=stdout)
</pre></div>
</div>
<p>Using the command line interface and a single state key, or a related set that change
due to a single command, one can replicate the information in a backstop history
file.  For instance here</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ tail &lt;...&gt;/JAN0818/ofls/History/ATTITUDE.txt

2018006.072916206 | -5.27899874e-01 -6.92042461e-01 -4.90427812e-01  4.33533892e-02
2018006.103533882 |  4.51367966e-01  6.45077701e-01  6.14710906e-01  4.76678196e-02
2018006.130755248 | -4.28324009e-01 -4.40000915e-01  3.57368959e-01  7.03722364e-01
2018006.214420159 | -3.23403971e-01 -6.11564724e-01 -7.15954877e-01  9.38460120e-02
2018007.024414705 | -4.16664564e-01 -6.83613678e-01 -5.86236582e-01  1.24055031e-01
2018007.164807705 | -5.04030078e-01 -7.09485195e-01 -4.78304550e-01  1.17512532e-01

$ get_chandra_states --start 2018:006:07:29:16.206 --stop 2018:007:16:50:00 \
                     --state-keys=targ_q1,targ_q2,targ_q3,targ_q4

             datestart               datestop       targ_q1       targ_q2       targ_q3       targ_q4
 2018:006:07:29:16.206  2018:006:10:35:33.882  -0.527899874  -0.692042461  -0.490427812  0.0433533892
 2018:006:10:35:33.882  2018:006:13:07:55.248   0.451367966   0.645077701   0.614710906  0.0476678196
 2018:006:13:07:55.248  2018:006:21:44:20.159  -0.428324009  -0.440000915   0.357368959   0.703722364
 2018:006:21:44:20.159  2018:007:02:44:14.705  -0.323403971  -0.611564724  -0.715954877   0.093846012
 2018:007:02:44:14.705  2018:007:16:48:07.705  -0.416664564  -0.683613678  -0.586236582   0.124055031
 2018:007:16:48:07.705  2018:007:16:50:00.000  -0.504030078  -0.709485195   -0.47830455   0.117512532
</pre></div>
</div>
<p>To see more examples of this look at the backstop history section of the testing file
<a class="reference external" href="https://github.com/sot/kadi/blob/6cc8d7a241/kadi/commands/tests/test_states.py#L402">kadi/commands/tests/test_states.py</a>.
All of the supported state keys that reproduce backstop history files are tested here.</p>
</section>
<section id="states-from-commands">
<h4>States from commands<a class="headerlink" href="#states-from-commands" title="Permalink to this headline">¶</a></h4>
<p>Instead of relying on <a class="reference internal" href="api.html#kadi.commands.states.get_states" title="kadi.commands.states.get_states"><code class="xref py py-func docutils literal notranslate"><span class="pre">get_states()</span></code></a> to get the commands and continuity, you can do things
manually.  For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;2017:001:21:00:00&#39;</span><span class="p">,</span> <span class="s1">&#39;2017:002:11:29:00&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">state_keys</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;obsid&#39;</span><span class="p">,</span> <span class="s1">&#39;simpos&#39;</span><span class="p">,</span> <span class="s1">&#39;clocking&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cmds</span> <span class="o">=</span> <span class="n">commands</span><span class="o">.</span><span class="n">get_cmds</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">continuity</span> <span class="o">=</span> <span class="n">states</span><span class="o">.</span><span class="n">get_continuity</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">state_keys</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">states</span><span class="o">.</span><span class="n">get_states</span><span class="p">(</span><span class="n">cmds</span><span class="o">=</span><span class="n">cmds</span><span class="p">,</span> <span class="n">continuity</span><span class="o">=</span><span class="n">continuity</span><span class="p">,</span>
<span class="gp">... </span>                  <span class="n">state_keys</span><span class="o">=</span><span class="n">state_keys</span><span class="p">,</span>
<span class="gp">... </span>                  <span class="n">merge_identical</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="go">&lt;Table length=5&gt;</span>
<span class="go">      datestart              datestop       obsid simpos clocking    trans_keys</span>
<span class="go">        str21                 str21         int64 int64   int64        object</span>
<span class="go">--------------------- --------------------- ----- ------ -------- ---------------</span>
<span class="go">2017:001:21:02:06.467 2017:001:21:05:06.467 18140  75624        0        clocking</span>
<span class="go">2017:001:21:05:06.467 2017:001:21:06:45.467 19973  75624        0           obsid</span>
<span class="go">2017:001:21:06:45.467 2017:002:11:23:43.185 19973  75624        1        clocking</span>
<span class="go">2017:002:11:23:43.185 2017:002:11:26:43.185 19973 -99616        0 clocking,simpos</span>
<span class="go">2017:002:11:26:43.185 2017:002:11:26:43.185 50432 -99616        0           obsid</span>
</pre></div>
</div>
<p>In the call to <a class="reference internal" href="api.html#kadi.commands.states.get_states" title="kadi.commands.states.get_states"><code class="xref py py-func docutils literal notranslate"><span class="pre">get_states()</span></code></a>, if you omit the <code class="docutils literal notranslate"><span class="pre">continuity</span></code> argument it will be determined
internally using the first command date.</p>
<p>This manual process is normally what would be done in a load review code where one needs
to consider up to four different elements:</p>
<ul class="simple">
<li><p>Continuity value from some moment, for instance the time of last available telemetry
for thermal model propagation.</p></li>
<li><p>Commands from the continuity time until the start of loads.</p></li>
<li><p>Non-load commands (e.g. a possible CTI run)</p></li>
<li><p>Load commands</p></li>
</ul>
<p>In this case the calling code is responsible for logic to assemble a single commands table
for the <code class="docutils literal notranslate"><span class="pre">cmds</span></code> argument as a <code class="xref py py-class docutils literal notranslate"><span class="pre">CommandTable</span></code> object.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The plan is to provide convenience methods and documentation to make this
process more straightforward.  E.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get commands for new loads</span>
<span class="n">bs_cmds</span> <span class="o">=</span> <span class="n">parse_cm</span><span class="o">.</span><span class="n">read_backstop</span><span class="p">(</span><span class="n">backstop_file</span><span class="p">)</span>
<span class="n">load_start</span> <span class="o">=</span> <span class="n">bs_cmds</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;date&#39;</span><span class="p">]</span>

<span class="c1"># Get last telem from Ska archive.  NOTE: we can and should allow for use</span>
<span class="c1"># of MAUDE here to reduce propagation!</span>
<span class="n">last_tlm_date</span> <span class="o">=</span> <span class="n">fetch</span><span class="o">.</span><span class="n">get_time_range</span><span class="p">(</span><span class="s1">&#39;1dpamzt&#39;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;date&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>

<span class="c1"># Get approved commands from available telemetry through start of new loads</span>
<span class="n">cmds</span> <span class="o">=</span> <span class="n">commands</span><span class="o">.</span><span class="n">get_cmds</span><span class="p">(</span><span class="n">last_tlm_date</span><span class="p">,</span> <span class="n">load_start</span><span class="p">)</span>

<span class="c1"># Get pseudo-node values by running thermal model between</span>
<span class="c1"># last_tlm_date - 3 days to last_tlm_date, using estimate or</span>
<span class="c1"># fixed value of pseudo-node.</span>

<span class="c1"># Add backstop commands.  The ``add_commands`` method will sort, but up to</span>
<span class="c1"># user to make sure there is no overlap.</span>
<span class="n">cmds</span><span class="o">.</span><span class="n">add_commands</span><span class="p">(</span><span class="n">bs_cmds</span><span class="p">)</span>  <span class="c1"># not yet implemented</span>

<span class="c1"># Optionally insert any non-load commands, e.g. for a CTI that may or may not happen</span>
<span class="n">non_load_cmds</span> <span class="o">=</span> <span class="o">...</span>
<span class="n">cmds</span><span class="o">.</span><span class="n">add_commands</span><span class="p">(</span><span class="n">non_load_cmds</span><span class="p">)</span>

<span class="n">sts</span> <span class="o">=</span> <span class="n">states</span><span class="o">.</span><span class="n">get_states</span><span class="p">(</span><span class="n">cmds</span><span class="o">=</span><span class="n">cmds</span><span class="p">,</span> <span class="n">state_keys</span><span class="o">=</span><span class="p">[</span><span class="o">...</span><span class="p">])</span>
</pre></div>
</div>
</div>
</section>
</section>
<section id="continuity">
<h3>Continuity<a class="headerlink" href="#continuity" title="Permalink to this headline">¶</a></h3>
<p>To get the continuity state for a desired set of state keys at a certain time, use
<a class="reference internal" href="api.html#kadi.commands.states.get_continuity" title="kadi.commands.states.get_continuity"><code class="xref py py-func docutils literal notranslate"><span class="pre">get_continuity()</span></code></a>.  Before doing this, recall that in IPython one can always get
help on a function, class, or method with <code class="docutils literal notranslate"><span class="pre">&lt;something&gt;?</span></code> or <code class="docutils literal notranslate"><span class="pre">help(&lt;something&gt;)</span></code>.
So here is how to get help on the <a class="reference internal" href="api.html#kadi.commands.states.get_continuity" title="kadi.commands.states.get_continuity"><code class="xref py py-func docutils literal notranslate"><span class="pre">get_continuity()</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&gt;&gt;&gt; states.get_continuity?
Signature: states.get_continuity(date=None, state_keys=None, lookbacks=(7, 30, 180, 1000))
Docstring:
Get the state and transition dates at ``date`` for ``state_keys``.

This function finds the state at a particular date by fetching commands
prior to that date and determine the states.  It returns dictionary
``continuity`` provides the state values. Included in this dict is a special
key ``__dates__`` which provides the corresponding date at which the
state-changing command occurred.

Since some state keys like ``pitch`` change often (many times per day) while
others like ``letg`` may not change for weeks, this function does dynamic
lookbacks from ``date`` to find transitions for each key.  By default it
will try looking back 7 days, then 30 days, then 180 days, and finally 1000
days.  This lookback sequence can be controlled with the ``lookbacks``
argument.

If ``state_keys`` is ``None`` then the default keys ``states.DEFAULT_STATE_KEYS``
is used.  This corresponds to the &quot;classic&quot; Chandra commanded states (obsid,
ACIS, PCAD, and mechanisms).

:param date: date (DateTime compatible, default=NOW)
:param state_keys: list of state keys or str (one state key) or None
:param lookbacks: list of lookback times in days (default=[7, 30, 180, 1000])

:returns: dict of state values
</pre></div>
</div>
<p>So let’s get the state of <code class="docutils literal notranslate"><span class="pre">obsid</span></code> and <code class="docutils literal notranslate"><span class="pre">si_mode</span></code> at <code class="docutils literal notranslate"><span class="pre">2017:300:00:00:00</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">continuity</span> <span class="o">=</span> <span class="n">states</span><span class="o">.</span><span class="n">get_continuity</span><span class="p">(</span><span class="s1">&#39;2017:300:00:00:00&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;obsid&#39;</span><span class="p">,</span> <span class="s1">&#39;si_mode&#39;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">continuity</span>
<span class="go">{&#39;__dates__&#39;: {&#39;obsid&#39;: &#39;2017:299:21:50:34.193&#39;,</span>
<span class="go">               &#39;si_mode&#39;: &#39;2017:299:22:02:41.439&#39;},</span>
<span class="go"> &#39;obsid&#39;: 19385,</span>
<span class="go"> &#39;si_mode&#39;: &#39;TE_00A02&#39;}</span>
</pre></div>
</div>
<p>The return value is a <code class="docutils literal notranslate"><span class="pre">dict</span></code> which has key/value pairs for each of the
desired state keys.  It also has a <code class="docutils literal notranslate"><span class="pre">__dates__</span></code> item which has the
corresponding date when state key changed value because of a command.
To prove this, let’s look at the commands exactly at the state transition time:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">cmds</span> <span class="o">=</span> <span class="n">commands</span><span class="o">.</span><span class="n">get_cmds</span><span class="p">(</span><span class="n">date</span><span class="o">=</span><span class="n">continuity</span><span class="p">[</span><span class="s1">&#39;__dates__&#39;</span><span class="p">][</span><span class="s1">&#39;obsid&#39;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cmds</span><span class="o">.</span><span class="n">fetch_params</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">cmds</span><span class="p">)</span>
<span class="go">         date           type    tlmsid  scs step timeline_id      params</span>
<span class="go">--------------------- -------- -------- --- ---- ----------- ---------------</span>
<span class="go">2017:299:21:50:34.193 MP_OBSID COAOSQID 131  495   426102876 cmds=3 id=19385</span>
</pre></div>
</div>
<p>If no value is supplied for the <code class="docutils literal notranslate"><span class="pre">state_keys</span></code> argument then the default set of
state keys shown below is used:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">states</span><span class="o">.</span><span class="n">DEFAULT_STATE_KEYS</span>
<span class="go">(&#39;ccd_count&#39;,</span>
<span class="go"> &#39;clocking&#39;,</span>
<span class="go"> &#39;dec&#39;,</span>
<span class="go"> &#39;dither&#39;,</span>
<span class="go"> &#39;fep_count&#39;,</span>
<span class="go"> &#39;hetg&#39;,</span>
<span class="go"> &#39;letg&#39;,</span>
<span class="go"> &#39;obsid&#39;,</span>
<span class="go"> &#39;off_nom_roll&#39;,</span>
<span class="go"> &#39;pcad_mode&#39;,</span>
<span class="go"> &#39;pitch&#39;,</span>
<span class="go"> &#39;power_cmd&#39;,</span>
<span class="go"> &#39;q1&#39;,</span>
<span class="go"> &#39;q2&#39;,</span>
<span class="go"> &#39;q3&#39;,</span>
<span class="go"> &#39;q4&#39;,</span>
<span class="go"> &#39;ra&#39;,</span>
<span class="go"> &#39;roll&#39;,</span>
<span class="go"> &#39;si_mode&#39;,</span>
<span class="go"> &#39;simfa_pos&#39;,</span>
<span class="go"> &#39;simpos&#39;,</span>
<span class="go"> &#39;targ_q1&#39;,</span>
<span class="go"> &#39;targ_q2&#39;,</span>
<span class="go"> &#39;targ_q3&#39;,</span>
<span class="go"> &#39;targ_q4&#39;,</span>
<span class="go"> &#39;vid_board&#39;)</span>
</pre></div>
</div>
</section>
<section id="state-keys">
<h3>State keys<a class="headerlink" href="#state-keys" title="Permalink to this headline">¶</a></h3>
<p>The list below shows available state keys along with a list of the transition
classes which affect the keys.</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">acisfp_setpoint</span></code></dt><dd><ul class="simple">
<li><p><a class="reference internal" href="api.html#kadi.commands.states.ACISFP_SetPointTransition" title="kadi.commands.states.ACISFP_SetPointTransition"><code class="xref py py-class docutils literal notranslate"><span class="pre">ACISFP_SetPointTransition</span></code></a></p></li>
</ul>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">aoephem1</span></code>, <code class="docutils literal notranslate"><span class="pre">aoephem2</span></code>, <code class="docutils literal notranslate"><span class="pre">aoratio</span></code>, <code class="docutils literal notranslate"><span class="pre">aoargper</span></code>, <code class="docutils literal notranslate"><span class="pre">aoeccent</span></code>, <code class="docutils literal notranslate"><span class="pre">ao1minus</span></code>, <code class="docutils literal notranslate"><span class="pre">ao1plus</span></code>, <code class="docutils literal notranslate"><span class="pre">aomotion</span></code>, <code class="docutils literal notranslate"><span class="pre">aoiterat</span></code>, <code class="docutils literal notranslate"><span class="pre">aoorbang</span></code>, <code class="docutils literal notranslate"><span class="pre">aoperige</span></code>, <code class="docutils literal notranslate"><span class="pre">aoascend</span></code>, <code class="docutils literal notranslate"><span class="pre">aosini</span></code>, <code class="docutils literal notranslate"><span class="pre">aoslr</span></code>, <code class="docutils literal notranslate"><span class="pre">aosqrtmu</span></code></dt><dd><ul class="simple">
<li><p><a class="reference internal" href="api.html#kadi.commands.states.EphemerisTransition" title="kadi.commands.states.EphemerisTransition"><code class="xref py py-class docutils literal notranslate"><span class="pre">EphemerisTransition</span></code></a></p></li>
</ul>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">clocking</span></code>, <code class="docutils literal notranslate"><span class="pre">power_cmd</span></code>, <code class="docutils literal notranslate"><span class="pre">vid_board</span></code>, <code class="docutils literal notranslate"><span class="pre">fep_count</span></code>, <code class="docutils literal notranslate"><span class="pre">si_mode</span></code>, <code class="docutils literal notranslate"><span class="pre">ccd_count</span></code></dt><dd><ul class="simple">
<li><p><a class="reference internal" href="api.html#kadi.commands.states.ACISTransition" title="kadi.commands.states.ACISTransition"><code class="xref py py-class docutils literal notranslate"><span class="pre">ACISTransition</span></code></a></p></li>
</ul>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">dither</span></code></dt><dd><ul class="simple">
<li><p><a class="reference internal" href="api.html#kadi.commands.states.DitherDisableTransition" title="kadi.commands.states.DitherDisableTransition"><code class="xref py py-class docutils literal notranslate"><span class="pre">DitherDisableTransition</span></code></a></p></li>
<li><p><a class="reference internal" href="api.html#kadi.commands.states.DitherEnableTransition" title="kadi.commands.states.DitherEnableTransition"><code class="xref py py-class docutils literal notranslate"><span class="pre">DitherEnableTransition</span></code></a></p></li>
</ul>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">dither_phase_pitch</span></code>, <code class="docutils literal notranslate"><span class="pre">dither_phase_yaw</span></code>, <code class="docutils literal notranslate"><span class="pre">dither_ampl_pitch</span></code>, <code class="docutils literal notranslate"><span class="pre">dither_ampl_yaw</span></code>, <code class="docutils literal notranslate"><span class="pre">dither_period_pitch</span></code>, <code class="docutils literal notranslate"><span class="pre">dither_period_yaw</span></code></dt><dd><ul class="simple">
<li><p><a class="reference internal" href="api.html#kadi.commands.states.DitherParamsTransition" title="kadi.commands.states.DitherParamsTransition"><code class="xref py py-class docutils literal notranslate"><span class="pre">DitherParamsTransition</span></code></a></p></li>
</ul>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">eclipse</span></code></dt><dd><ul class="simple">
<li><p><a class="reference internal" href="api.html#kadi.commands.states.EclipsePenumbraEntryTransition" title="kadi.commands.states.EclipsePenumbraEntryTransition"><code class="xref py py-class docutils literal notranslate"><span class="pre">EclipsePenumbraEntryTransition</span></code></a></p></li>
<li><p><a class="reference internal" href="api.html#kadi.commands.states.EclipsePenumbraExitTransition" title="kadi.commands.states.EclipsePenumbraExitTransition"><code class="xref py py-class docutils literal notranslate"><span class="pre">EclipsePenumbraExitTransition</span></code></a></p></li>
<li><p><a class="reference internal" href="api.html#kadi.commands.states.EclipseUmbraEntryTransition" title="kadi.commands.states.EclipseUmbraEntryTransition"><code class="xref py py-class docutils literal notranslate"><span class="pre">EclipseUmbraEntryTransition</span></code></a></p></li>
<li><p><a class="reference internal" href="api.html#kadi.commands.states.EclipseUmbraExitTransition" title="kadi.commands.states.EclipseUmbraExitTransition"><code class="xref py py-class docutils literal notranslate"><span class="pre">EclipseUmbraExitTransition</span></code></a></p></li>
</ul>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">eclipse_timer</span></code></dt><dd><ul class="simple">
<li><p><a class="reference internal" href="api.html#kadi.commands.states.EclipseEntryTimerTransition" title="kadi.commands.states.EclipseEntryTimerTransition"><code class="xref py py-class docutils literal notranslate"><span class="pre">EclipseEntryTimerTransition</span></code></a></p></li>
</ul>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">ephem_update</span></code></dt><dd><ul class="simple">
<li><p><a class="reference internal" href="api.html#kadi.commands.states.EphemerisUpdateTransition" title="kadi.commands.states.EphemerisUpdateTransition"><code class="xref py py-class docutils literal notranslate"><span class="pre">EphemerisUpdateTransition</span></code></a></p></li>
</ul>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">format</span></code></dt><dd><ul class="simple">
<li><p><a class="reference internal" href="api.html#kadi.commands.states.Format1_Transition" title="kadi.commands.states.Format1_Transition"><code class="xref py py-class docutils literal notranslate"><span class="pre">Format1_Transition</span></code></a></p></li>
<li><p><a class="reference internal" href="api.html#kadi.commands.states.Format2_Transition" title="kadi.commands.states.Format2_Transition"><code class="xref py py-class docutils literal notranslate"><span class="pre">Format2_Transition</span></code></a></p></li>
<li><p><a class="reference internal" href="api.html#kadi.commands.states.Format3_Transition" title="kadi.commands.states.Format3_Transition"><code class="xref py py-class docutils literal notranslate"><span class="pre">Format3_Transition</span></code></a></p></li>
<li><p><a class="reference internal" href="api.html#kadi.commands.states.Format4_Transition" title="kadi.commands.states.Format4_Transition"><code class="xref py py-class docutils literal notranslate"><span class="pre">Format4_Transition</span></code></a></p></li>
<li><p><a class="reference internal" href="api.html#kadi.commands.states.Format5_Transition" title="kadi.commands.states.Format5_Transition"><code class="xref py py-class docutils literal notranslate"><span class="pre">Format5_Transition</span></code></a></p></li>
<li><p><a class="reference internal" href="api.html#kadi.commands.states.Format6_Transition" title="kadi.commands.states.Format6_Transition"><code class="xref py py-class docutils literal notranslate"><span class="pre">Format6_Transition</span></code></a></p></li>
</ul>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">hrc_15v</span></code></dt><dd><ul class="simple">
<li><p><a class="reference internal" href="api.html#kadi.commands.states.Hrc15vOff_Transition" title="kadi.commands.states.Hrc15vOff_Transition"><code class="xref py py-class docutils literal notranslate"><span class="pre">Hrc15vOff_Transition</span></code></a></p></li>
<li><p><a class="reference internal" href="api.html#kadi.commands.states.Hrc15vOn_SCS134_Transition" title="kadi.commands.states.Hrc15vOn_SCS134_Transition"><code class="xref py py-class docutils literal notranslate"><span class="pre">Hrc15vOn_SCS134_Transition</span></code></a></p></li>
<li><p><a class="reference internal" href="api.html#kadi.commands.states.Hrc15vOn_Transition" title="kadi.commands.states.Hrc15vOn_Transition"><code class="xref py py-class docutils literal notranslate"><span class="pre">Hrc15vOn_Transition</span></code></a></p></li>
</ul>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">hrc_24v</span></code></dt><dd><ul class="simple">
<li><p><a class="reference internal" href="api.html#kadi.commands.states.Hrc24vOff_Transition" title="kadi.commands.states.Hrc24vOff_Transition"><code class="xref py py-class docutils literal notranslate"><span class="pre">Hrc24vOff_Transition</span></code></a></p></li>
<li><p><a class="reference internal" href="api.html#kadi.commands.states.Hrc24vOn_Transition" title="kadi.commands.states.Hrc24vOn_Transition"><code class="xref py py-class docutils literal notranslate"><span class="pre">Hrc24vOn_Transition</span></code></a></p></li>
</ul>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">hrc_i</span></code></dt><dd><ul class="simple">
<li><p><a class="reference internal" href="api.html#kadi.commands.states.HrcIOff_Transition" title="kadi.commands.states.HrcIOff_Transition"><code class="xref py py-class docutils literal notranslate"><span class="pre">HrcIOff_Transition</span></code></a></p></li>
<li><p><a class="reference internal" href="api.html#kadi.commands.states.HrcIOn_Transition" title="kadi.commands.states.HrcIOn_Transition"><code class="xref py py-class docutils literal notranslate"><span class="pre">HrcIOn_Transition</span></code></a></p></li>
</ul>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">hrc_s</span></code></dt><dd><ul class="simple">
<li><p><a class="reference internal" href="api.html#kadi.commands.states.HrcSOff_Transition" title="kadi.commands.states.HrcSOff_Transition"><code class="xref py py-class docutils literal notranslate"><span class="pre">HrcSOff_Transition</span></code></a></p></li>
<li><p><a class="reference internal" href="api.html#kadi.commands.states.HrcSOn_Transition" title="kadi.commands.states.HrcSOn_Transition"><code class="xref py py-class docutils literal notranslate"><span class="pre">HrcSOn_Transition</span></code></a></p></li>
</ul>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">letg</span></code>, <code class="docutils literal notranslate"><span class="pre">hetg</span></code>, <code class="docutils literal notranslate"><span class="pre">grating</span></code></dt><dd><ul class="simple">
<li><p><a class="reference internal" href="api.html#kadi.commands.states.HETG_INSR_Transition" title="kadi.commands.states.HETG_INSR_Transition"><code class="xref py py-class docutils literal notranslate"><span class="pre">HETG_INSR_Transition</span></code></a></p></li>
<li><p><a class="reference internal" href="api.html#kadi.commands.states.HETG_RETR_Transition" title="kadi.commands.states.HETG_RETR_Transition"><code class="xref py py-class docutils literal notranslate"><span class="pre">HETG_RETR_Transition</span></code></a></p></li>
<li><p><a class="reference internal" href="api.html#kadi.commands.states.LETG_INSR_Transition" title="kadi.commands.states.LETG_INSR_Transition"><code class="xref py py-class docutils literal notranslate"><span class="pre">LETG_INSR_Transition</span></code></a></p></li>
<li><p><a class="reference internal" href="api.html#kadi.commands.states.LETG_RETR_Transition" title="kadi.commands.states.LETG_RETR_Transition"><code class="xref py py-class docutils literal notranslate"><span class="pre">LETG_RETR_Transition</span></code></a></p></li>
</ul>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">obsid</span></code></dt><dd><ul class="simple">
<li><p><a class="reference internal" href="api.html#kadi.commands.states.ObsidTransition" title="kadi.commands.states.ObsidTransition"><code class="xref py py-class docutils literal notranslate"><span class="pre">ObsidTransition</span></code></a></p></li>
</ul>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">orbit_point</span></code></dt><dd><ul class="simple">
<li><p><a class="reference internal" href="api.html#kadi.commands.states.OrbitPointTransition" title="kadi.commands.states.OrbitPointTransition"><code class="xref py py-class docutils literal notranslate"><span class="pre">OrbitPointTransition</span></code></a></p></li>
</ul>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">q1</span></code>, <code class="docutils literal notranslate"><span class="pre">q2</span></code>, <code class="docutils literal notranslate"><span class="pre">q3</span></code>, <code class="docutils literal notranslate"><span class="pre">q4</span></code>, <code class="docutils literal notranslate"><span class="pre">targ_q1</span></code>, <code class="docutils literal notranslate"><span class="pre">targ_q2</span></code>, <code class="docutils literal notranslate"><span class="pre">targ_q3</span></code>, <code class="docutils literal notranslate"><span class="pre">targ_q4</span></code>, <code class="docutils literal notranslate"><span class="pre">ra</span></code>, <code class="docutils literal notranslate"><span class="pre">dec</span></code>, <code class="docutils literal notranslate"><span class="pre">roll</span></code>, <code class="docutils literal notranslate"><span class="pre">auto_npnt</span></code>, <code class="docutils literal notranslate"><span class="pre">pcad_mode</span></code>, <code class="docutils literal notranslate"><span class="pre">pitch</span></code>, <code class="docutils literal notranslate"><span class="pre">off_nom_roll</span></code></dt><dd><ul class="simple">
<li><p><a class="reference internal" href="api.html#kadi.commands.states.AutoNPMDisableTransition" title="kadi.commands.states.AutoNPMDisableTransition"><code class="xref py py-class docutils literal notranslate"><span class="pre">AutoNPMDisableTransition</span></code></a></p></li>
<li><p><a class="reference internal" href="api.html#kadi.commands.states.AutoNPMEnableTransition" title="kadi.commands.states.AutoNPMEnableTransition"><code class="xref py py-class docutils literal notranslate"><span class="pre">AutoNPMEnableTransition</span></code></a></p></li>
<li><p><a class="reference internal" href="api.html#kadi.commands.states.ManeuverTransition" title="kadi.commands.states.ManeuverTransition"><code class="xref py py-class docutils literal notranslate"><span class="pre">ManeuverTransition</span></code></a></p></li>
<li><p><a class="reference internal" href="api.html#kadi.commands.states.NMM_Transition" title="kadi.commands.states.NMM_Transition"><code class="xref py py-class docutils literal notranslate"><span class="pre">NMM_Transition</span></code></a></p></li>
<li><p><a class="reference internal" href="api.html#kadi.commands.states.NPM_Transition" title="kadi.commands.states.NPM_Transition"><code class="xref py py-class docutils literal notranslate"><span class="pre">NPM_Transition</span></code></a></p></li>
<li><p><a class="reference internal" href="api.html#kadi.commands.states.NormalSunTransition" title="kadi.commands.states.NormalSunTransition"><code class="xref py py-class docutils literal notranslate"><span class="pre">NormalSunTransition</span></code></a></p></li>
<li><p><a class="reference internal" href="api.html#kadi.commands.states.SunVectorTransition" title="kadi.commands.states.SunVectorTransition"><code class="xref py py-class docutils literal notranslate"><span class="pre">SunVectorTransition</span></code></a></p></li>
<li><p><a class="reference internal" href="api.html#kadi.commands.states.TargQuatTransition" title="kadi.commands.states.TargQuatTransition"><code class="xref py py-class docutils literal notranslate"><span class="pre">TargQuatTransition</span></code></a></p></li>
</ul>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">radmon</span></code></dt><dd><ul class="simple">
<li><p><a class="reference internal" href="api.html#kadi.commands.states.RadmonDisableTransition" title="kadi.commands.states.RadmonDisableTransition"><code class="xref py py-class docutils literal notranslate"><span class="pre">RadmonDisableTransition</span></code></a></p></li>
<li><p><a class="reference internal" href="api.html#kadi.commands.states.RadmonEnableTransition" title="kadi.commands.states.RadmonEnableTransition"><code class="xref py py-class docutils literal notranslate"><span class="pre">RadmonEnableTransition</span></code></a></p></li>
</ul>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">scs84</span></code></dt><dd><ul class="simple">
<li><p><a class="reference internal" href="api.html#kadi.commands.states.SCS84DisableTransition" title="kadi.commands.states.SCS84DisableTransition"><code class="xref py py-class docutils literal notranslate"><span class="pre">SCS84DisableTransition</span></code></a></p></li>
<li><p><a class="reference internal" href="api.html#kadi.commands.states.SCS84EnableTransition" title="kadi.commands.states.SCS84EnableTransition"><code class="xref py py-class docutils literal notranslate"><span class="pre">SCS84EnableTransition</span></code></a></p></li>
</ul>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">scs98</span></code></dt><dd><ul class="simple">
<li><p><a class="reference internal" href="api.html#kadi.commands.states.SCS98DisableTransition" title="kadi.commands.states.SCS98DisableTransition"><code class="xref py py-class docutils literal notranslate"><span class="pre">SCS98DisableTransition</span></code></a></p></li>
<li><p><a class="reference internal" href="api.html#kadi.commands.states.SCS98EnableTransition" title="kadi.commands.states.SCS98EnableTransition"><code class="xref py py-class docutils literal notranslate"><span class="pre">SCS98EnableTransition</span></code></a></p></li>
</ul>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">simfa_pos</span></code></dt><dd><ul class="simple">
<li><p><a class="reference internal" href="api.html#kadi.commands.states.SimFocusTransition" title="kadi.commands.states.SimFocusTransition"><code class="xref py py-class docutils literal notranslate"><span class="pre">SimFocusTransition</span></code></a></p></li>
</ul>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">simpos</span></code></dt><dd><ul class="simple">
<li><p><a class="reference internal" href="api.html#kadi.commands.states.SimTscTransition" title="kadi.commands.states.SimTscTransition"><code class="xref py py-class docutils literal notranslate"><span class="pre">SimTscTransition</span></code></a></p></li>
</ul>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">subformat</span></code></dt><dd><ul class="simple">
<li><p><a class="reference internal" href="api.html#kadi.commands.states.SubFormatEPS_Transition" title="kadi.commands.states.SubFormatEPS_Transition"><code class="xref py py-class docutils literal notranslate"><span class="pre">SubFormatEPS_Transition</span></code></a></p></li>
<li><p><a class="reference internal" href="api.html#kadi.commands.states.SubFormatNRM_Transition" title="kadi.commands.states.SubFormatNRM_Transition"><code class="xref py py-class docutils literal notranslate"><span class="pre">SubFormatNRM_Transition</span></code></a></p></li>
<li><p><a class="reference internal" href="api.html#kadi.commands.states.SubFormatPDG_Transition" title="kadi.commands.states.SubFormatPDG_Transition"><code class="xref py py-class docutils literal notranslate"><span class="pre">SubFormatPDG_Transition</span></code></a></p></li>
<li><p><a class="reference internal" href="api.html#kadi.commands.states.SubFormatSSR_Transition" title="kadi.commands.states.SubFormatSSR_Transition"><code class="xref py py-class docutils literal notranslate"><span class="pre">SubFormatSSR_Transition</span></code></a></p></li>
</ul>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">sun_pos_mon</span></code></dt><dd><ul class="simple">
<li><p><a class="reference internal" href="api.html#kadi.commands.states.SPMDisableTransition" title="kadi.commands.states.SPMDisableTransition"><code class="xref py py-class docutils literal notranslate"><span class="pre">SPMDisableTransition</span></code></a></p></li>
<li><p><a class="reference internal" href="api.html#kadi.commands.states.SPMEclipseEnableTransition" title="kadi.commands.states.SPMEclipseEnableTransition"><code class="xref py py-class docutils literal notranslate"><span class="pre">SPMEclipseEnableTransition</span></code></a></p></li>
<li><p><a class="reference internal" href="api.html#kadi.commands.states.SPMEnableTransition" title="kadi.commands.states.SPMEnableTransition"><code class="xref py py-class docutils literal notranslate"><span class="pre">SPMEnableTransition</span></code></a></p></li>
</ul>
</dd>
</dl>
</section>
<section id="implementation">
<h3>Implementation<a class="headerlink" href="#implementation" title="Permalink to this headline">¶</a></h3>
<p>Basic design concepts for transition classes:</p>
<ul>
<li><p>All state-key specific information is encapsulated in Transition classes.  These inherit
from <a class="reference internal" href="api.html#kadi.commands.states.BaseTransition" title="kadi.commands.states.BaseTransition"><code class="xref py py-class docutils literal notranslate"><span class="pre">BaseTransition</span></code></a> and have attributes to specify:</p>
<ul class="simple">
<li><p>Command that generates state change</p></li>
<li><p>State key(s) that require this transition</p></li>
</ul>
</li>
<li><p>Simple cases are handled using <a class="reference internal" href="api.html#kadi.commands.states.BaseTransition" title="kadi.commands.states.BaseTransition"><code class="xref py py-class docutils literal notranslate"><span class="pre">BaseTransition</span></code></a> sub-classes
that need only define class attributes.</p></li>
<li><p>Transition classes are never instantiated, they contain only class methods.</p></li>
<li><p>Transition classes have two key methods:</p>
<dl class="simple">
<dt><a class="reference internal" href="api.html#kadi.commands.states.BaseTransition.get_state_changing_commands" title="kadi.commands.states.BaseTransition.get_state_changing_commands"><code class="xref py py-func docutils literal notranslate"><span class="pre">get_state_changing_commands()</span></code></a></dt><dd><p>Quickly get a list of applicable commands using (usually) numpy filtering
instead of looping and if/elif through every command.  This is done in the
method and allows for getting a year of states in &lt; 10-20 seconds.  This
requirement drives some other code complexity, in particular transition
function callbacks, where a transition is specified as a function that gets
called during state evaluation.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">set_transitions()</span></code></dt><dd><p>Given a table of applicable commands, generate corresponding state
transitions as a dict of state key updates.</p>
</dd>
</dl>
</li>
<li><p>Once all transition dicts have been collected into a time-ordered list they are
evaluated in order to accumulate discrete states.  Transition callback
functions can dynamically add downstream transitions during this process to
handle events like a maneuver, where the current state is required to generate
mid-maneuver attitudes and the NPM transition.</p></li>
<li><p>The signature of a transition function callback is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">callback</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">transitions</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">idx</span><span class="p">):</span>
</pre></div>
</div>
<p>It has access to the current state date, the complete list of transitions,
the current state, the current index into the transitions list, and
any other keyword args in the transition that were inserted when transitions
were set.  This function can add downstream transitions or directly update
the current state.</p>
</li>
</ul>
</section>
<section id="user-defined-states">
<h3>User-defined states<a class="headerlink" href="#user-defined-states" title="Permalink to this headline">¶</a></h3>
<p>One of the driving factors in the design of the commanded states module is making it easy
for users to create custom states with minimal effort.  With the available base classes,
and in particular <a class="reference internal" href="api.html#kadi.commands.states.FixedTransition" title="kadi.commands.states.FixedTransition"><code class="xref py py-class docutils literal notranslate"><span class="pre">FixedTransition</span></code></a> and
<a class="reference internal" href="api.html#kadi.commands.states.ParamTransition" title="kadi.commands.states.ParamTransition"><code class="xref py py-class docutils literal notranslate"><span class="pre">ParamTransition</span></code></a>, it is often just a few lines of code.</p>
<p>For example, if we were interested in the state of the IU mode select, we look at examples
of the relevant command, which in this case is <code class="docutils literal notranslate"><span class="pre">CIMODESL</span></code>.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">cmds</span> <span class="o">=</span> <span class="n">commands</span><span class="o">.</span><span class="n">get_cmds</span><span class="p">(</span><span class="s1">&#39;2017:360&#39;</span><span class="p">,</span> <span class="s1">&#39;2018:001&#39;</span><span class="p">,</span> <span class="n">tlmsid</span><span class="o">=</span><span class="s1">&#39;CIMODESL&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cmds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="go">&lt;Cmd 2017:360:14:05:00.000 COMMAND_HW tlmsid=CIMODESL scs=128 step=2 timeline_id=426102971 hex=7C063C0 msid=CIU1024T&gt;</span>
</pre></div>
</div>
<p>Here we see that the IU mode state value is captured in the <code class="docutils literal notranslate"><span class="pre">msid</span></code> parameter.  That tells
us this can be implemented as a <a class="reference internal" href="api.html#kadi.commands.states.ParamTransition" title="kadi.commands.states.ParamTransition"><code class="xref py py-class docutils literal notranslate"><span class="pre">ParamTransition</span></code></a> sub-class.
This class is documented, but in practice it is probably easiest to look through the available
classes in the code and find an example.  In this case the <a class="reference internal" href="api.html#kadi.commands.states.ObsidTransition" title="kadi.commands.states.ObsidTransition"><code class="xref py py-class docutils literal notranslate"><span class="pre">ObsidTransition</span></code></a> class:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ObsidTransition</span><span class="p">(</span><span class="n">ParamTransition</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Obsid update&quot;&quot;&quot;</span>
    <span class="n">command_attributes</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;MP_OBSID&#39;</span><span class="p">}</span>
    <span class="n">state_keys</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;obsid&#39;</span><span class="p">]</span>
    <span class="n">transition_key</span> <span class="o">=</span> <span class="s1">&#39;obsid&#39;</span>
    <span class="n">cmd_param_key</span> <span class="o">=</span> <span class="s1">&#39;id&#39;</span>
</pre></div>
</div>
<p>So we just adapt this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">kadi.commands.states</span> <span class="kn">import</span> <span class="n">ParamTransition</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">IUModeSelectTransition</span><span class="p">(</span><span class="n">ParamTransition</span><span class="p">):</span>
<span class="gp">... </span>    <span class="sd">&quot;&quot;&quot;IU mode select update&quot;&quot;&quot;</span>
<span class="gp">... </span>    <span class="n">command_attributes</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;tlmsid&#39;</span><span class="p">:</span> <span class="s1">&#39;CIMODESL&#39;</span><span class="p">}</span>
<span class="gp">... </span>    <span class="n">state_keys</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;iu_mode_select&#39;</span><span class="p">]</span>
<span class="gp">... </span>    <span class="n">transition_key</span> <span class="o">=</span> <span class="s1">&#39;iu_mode_select&#39;</span>
<span class="gp">... </span>    <span class="n">cmd_param_key</span> <span class="o">=</span> <span class="s1">&#39;msid&#39;</span>
</pre></div>
</div>
<p>Notes:</p>
<ul class="simple">
<li><p>Just by running this code, the state is <em>automatically registered</em> and becomes part of the system.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">command_attributes</span></code> class attribute selects which commands will cause this state transition.
This attribute is relevant for most transition classes.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">state_keys</span></code> attribute indicates when this class will be included in processing.  In other
words, when the user requests states or continuity, they generally provide a <code class="docutils literal notranslate"><span class="pre">state_keys</span></code> argument
specifying which keys are desired.  If the user <code class="docutils literal notranslate"><span class="pre">state_keys</span></code> overlaps with the class <code class="docutils literal notranslate"><span class="pre">state_keys</span></code>,
then this class will be processed.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">transition_key</span></code> and <code class="docutils literal notranslate"><span class="pre">cmd_param_key</span></code> attributes are specific to the
<a class="reference internal" href="api.html#kadi.commands.states.ParamTransition" title="kadi.commands.states.ParamTransition"><code class="xref py py-class docutils literal notranslate"><span class="pre">ParamTransition</span></code></a> base class and indicate the <em>name</em> of the
state to update using the <em>value</em> of the  specified command parameter, respectively.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code class="docutils literal notranslate"><span class="pre">transition_key</span></code> must be in the <code class="docutils literal notranslate"><span class="pre">state_keys</span></code> list, but not vica-versa.
The subtlety here is that if you have multiple transition classes that affect multiple
states as a group, all the transition classes need to have the <strong>same</strong> <code class="docutils literal notranslate"><span class="pre">state_keys</span></code>
attribute.  An example of this is in the grating transition classes, e.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">HETG_INSR_Transition</span><span class="p">(</span><span class="n">FixedTransition</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;HETG insertion&quot;&quot;&quot;</span>
    <span class="n">command_attributes</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;tlmsid&#39;</span><span class="p">:</span> <span class="s1">&#39;4OHETGIN&#39;</span><span class="p">}</span> <span class="c1"># Command (HETG insert)</span>
    <span class="n">state_keys</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;letg&#39;</span><span class="p">,</span> <span class="s1">&#39;hetg&#39;</span><span class="p">,</span> <span class="s1">&#39;grating&#39;</span><span class="p">]</span>    <span class="c1"># Collective set of grating states</span>
    <span class="n">transition_key</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;hetg&#39;</span><span class="p">,</span> <span class="s1">&#39;grating&#39;</span><span class="p">]</span>        <span class="c1"># States that *this* class sets</span>
    <span class="n">transition_val</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;INSR&#39;</span><span class="p">,</span> <span class="s1">&#39;HETG&#39;</span><span class="p">]</span>           <span class="c1"># Corresponding fixed values</span>
</pre></div>
</div>
</div>
<p>So now with our new <code class="docutils literal notranslate"><span class="pre">IUModeSelectTransition</span></code> class defined, we can use it!</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">states</span><span class="o">.</span><span class="n">get_continuity</span><span class="p">(</span><span class="s1">&#39;2018:001&#39;</span><span class="p">,</span> <span class="n">state_keys</span><span class="o">=</span><span class="s1">&#39;iu_mode_select&#39;</span><span class="p">)</span>
<span class="go">{&#39;__dates__&#39;: {&#39;iu_mode_select&#39;: &#39;2018:001:02:30:00.000&#39;},</span>
<span class="go"> &#39;iu_mode_select&#39;: &#39;CIU1024T&#39;}</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">states</span><span class="o">.</span><span class="n">get_states</span><span class="p">(</span><span class="s1">&#39;2018:001&#39;</span><span class="p">,</span> <span class="s1">&#39;2018:004&#39;</span><span class="p">,</span> <span class="n">state_keys</span><span class="o">=</span><span class="s1">&#39;iu_mode_select&#39;</span><span class="p">)</span>
<span class="go">&lt;Table length=19&gt;</span>
<span class="go">      datestart              datestop       iu_mode_select   trans_keys</span>
<span class="go">        str21                 str21              str8          object</span>
<span class="go">--------------------- --------------------- -------------- --------------</span>
<span class="go">2018:001:12:00:00.000 2018:001:12:45:00.000       CIU1024T</span>
<span class="go">2018:001:12:45:00.000 2018:001:19:45:00.000       CIU1024X iu_mode_select</span>
<span class="go">2018:001:19:45:00.000 2018:002:02:00:00.000       CIU1024X iu_mode_select</span>
<span class="go">2018:002:02:00:00.000 2018:002:11:20:00.000       CIU1024T iu_mode_select</span>
<span class="go">2018:002:11:20:00.000 2018:002:19:00:00.000       CIU1024X iu_mode_select</span>
<span class="go">2018:002:19:00:00.000 2018:002:19:12:00.000        CIU512T iu_mode_select</span>
<span class="go">2018:002:19:12:00.000 2018:002:19:21:50.000       CIMODESL iu_mode_select</span>
<span class="go">2018:002:19:21:50.000 2018:002:19:55:00.000        CIU512T iu_mode_select</span>
<span class="go">2018:002:19:55:00.000 2018:002:20:04:50.000       CIMODESL iu_mode_select</span>
<span class="go">2018:002:20:04:50.000 2018:002:20:38:00.000        CIU512T iu_mode_select</span>
<span class="go">2018:002:20:38:00.000 2018:002:20:47:50.000       CIMODESL iu_mode_select</span>
<span class="go">2018:002:20:47:50.000 2018:002:21:21:00.000        CIU512T iu_mode_select</span>
<span class="go">2018:002:21:21:00.000 2018:002:21:30:50.000       CIMODESL iu_mode_select</span>
<span class="go">2018:002:21:30:50.000 2018:002:22:04:00.000        CIU512T iu_mode_select</span>
<span class="go">2018:002:22:04:00.000 2018:002:22:13:50.000       CIMODESL iu_mode_select</span>
<span class="go">2018:002:22:13:50.000 2018:003:11:10:00.000        CIU512T iu_mode_select</span>
<span class="go">2018:003:11:10:00.000 2018:003:19:35:00.000       CIU1024X iu_mode_select</span>
<span class="go">2018:003:19:35:00.000 2018:004:01:00:00.000       CIU1024T iu_mode_select</span>
<span class="go">2018:004:01:00:00.000 2018:004:12:00:00.000       CIU1024T iu_mode_select</span>
</pre></div>
</div>
<p>Sometimes the pre-defined base classes are not enough, and in these cases the main
challenge is typically defining the <code class="docutils literal notranslate"><span class="pre">set_transitions()</span></code> method and potentially defining
transition callback functions.  There are a number of examples of this in the kadi code
and this should serve as your starting point.  The Ska team will be happy to assist
you if this is not enough.</p>
</section>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="index.html">
              <img class="logo" src="_static/ska.png" alt="Logo"/>
            </a></p><h3>Page Contents</h3>
<ul>
<li><a class="reference internal" href="#">Commands and states</a><ul>
<li><a class="reference internal" href="#commands-archive-v2">Commands archive v2</a><ul>
<li><a class="reference internal" href="#initial-setup">Initial setup</a></li>
<li><a class="reference internal" href="#getting-commands">Getting commands</a></li>
<li><a class="reference internal" href="#getting-observations">Getting observations</a><ul>
<li><a class="reference internal" href="#under-the-hood">Under the hood</a></li>
</ul>
</li>
<li><a class="reference internal" href="#getting-star-catalogs">Getting star catalogs</a><ul>
<li><a class="reference internal" href="#getting-dicts-instead-of-aca-tables">Getting dicts instead of ACA tables</a></li>
<li><a class="reference internal" href="#getting-a-table-of-catalog-entries">Getting a Table of catalog entries</a></li>
<li><a class="reference internal" href="#caching">Caching</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#commands-archive-v1">Commands archive v1</a></li>
<li><a class="reference internal" href="#chandra-states-and-continuity">Chandra states and continuity</a><ul>
<li><a class="reference internal" href="#states">States</a><ul>
<li><a class="reference internal" href="#states-over-date-range">States over date range</a></li>
<li><a class="reference internal" href="#command-line-interface">Command line interface</a></li>
<li><a class="reference internal" href="#states-from-commands">States from commands</a></li>
</ul>
</li>
<li><a class="reference internal" href="#continuity">Continuity</a></li>
<li><a class="reference internal" href="#state-keys">State keys</a></li>
<li><a class="reference internal" href="#implementation">Implementation</a></li>
<li><a class="reference internal" href="#user-defined-states">User-defined states</a></li>
</ul>
</li>
</ul>
</li>
</ul>


  <h4>Previous topic</h4>
  <p class="topless"><a href="events.html"
                        title="previous chapter">Chandra events</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="commands_v2.html"
                        title="next chapter">Commands archive v2 details</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/commands_states.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<form action="search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
<footer class="footer">
  <p class="pull-right">
    <a href="_sources/commands_states.rst.txt"
       rel="nofollow">Page Source</a> &nbsp;
    <a href="#">Back to Top</a></p>
  <p>
    &copy; Copyright 2013, Tom Aldcroft.<br/>
    Created using <a href="http://www.sphinx-doc.org/en/stable/">Sphinx</a> 4.2.0. &nbsp;
  </p>
</footer>
  </body>
</html>